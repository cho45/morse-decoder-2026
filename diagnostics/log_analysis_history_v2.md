# ログ分析レポート v2: 対策適用後の停滞

## 1. 現状の確認
`checkpoints/history.csv` の最新データ（Epoch 779-792）を確認しました。

*   **Train Loss**: 0.26 付近で横ばい。
*   **Val Loss**: 0.25 付近で横ばい。
*   **Val CER**: 0.17 - 0.20 (17% - 20%) で完全に停滞。
*   **Learning Rate**: `0.00015` -> `0.00001875` と順調に下がっているが、改善が見られない。

## 2. 診断
前回の対策（重点サンプリング、LRリセット）適用後も、CERが約18%の壁を突破できていません。
これは「新しい文字（T, L, O）を覚えようとしているが、既存の文字（K, M, R, S）との区別がつかずに混乱している」状態を示唆しています。

特に懸念されるのは、**学習率が下がりきってしまった (Decay Plateau)** ことです。
LRが `1e-5` 台まで下がると、局所解から抜け出す力がなくなり、新しいパターン（新文字の特徴）を学習するのが困難になります。

## 3. 次の一手

もはや「小手先の調整」ではなく、モデルが「行き詰まり（Local Minima）」にハマっている可能性が高いです。
しかし、ユーザーからは「Blank Biasの変更は拒否」されています。

残された手段は以下の通りです。

### A. データセットの難易度調整 (Curriculum Relaxation)
*   現在、Phase 3 で `KMRSTLO` (7文字) を学習中ですが、一気に3文字増えたのが負荷になっている可能性があります。
*   特に `L` (.-..) と `R` (.-.) の混同が解消されていません。
*   **提案**: Phase 3 を分割し、まずは `T` (-) だけを追加する、次に `O` (---)、最後に `L` (.-..) とするなど、ステップを細かくする。

### B. モデルの表現力強化 (Capacity Boost)
*   現在の `d_model=128`, `n_layers=2` は、7文字以上の複雑なリズムパターンを分離するには力不足かもしれません。
*   しかし、アーキテクチャ変更はチェックポイントの互換性を失うため、最終手段です。

### C. 重点サンプリングの強化 (Aggressive Focus)
*   現在 `focus_prob=0.5` ですが、これを `0.8` 程度まで上げ、**「ほぼ新しい文字しか出ない」** 状況を作って強制的に学習させる。

## 結論
まずは **C. 重点サンプリングの強化** を試し、それでもダメなら **A. カリキュラムの細分化** を検討すべきです。
今回は、ユーザーの負担を減らすため、コード修正なしで対応できる範囲（パラメータ調整）ではなく、コード修正が必要ですが、**「重点サンプリング率を動的に上げる」** ロジックを追加することを検討します。

しかし、まずはユーザーに「学習率が下がりきって停滞している」事実を伝え、**学習の再起動（LRリセット）** を促すのが先決かもしれません。
前回の修正で「Phase進行時にLRリセット」は入れましたが、**「同じPhase内で停滞した時にLRを戻す」** 機能はありません。

**提案**: 手動で学習を停止し、`--resume latest` で再開する際、`--lr 0.0003` を明示的に指定して学習率を強制リセットしてみることを推奨します。